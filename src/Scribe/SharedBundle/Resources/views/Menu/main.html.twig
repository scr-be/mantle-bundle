{% set currentRoute = app.request.attributes.get('_route') %}

<!-- main navigation for the current site-context ("sub-site" context) -->
<div id="scr-navbar-context" role="navigation">
    <div class="navbar-header">
        <button class="navbar-toggle pull-right" type="button" data-toggle="collapse" data-target="#scr-navbar-context-main">
            <span class="sr-only">Toggle navigation</span>
            <core-icon icon="menu"></core-icon>
        </button>
        <button class="navbar-toggle pull-right" type="button" data-toggle="collapse" data-target="#scr-navbar-context-apps">
            <span class="sr-only">Toggle apps navigation</span>
            <core-icon icon="apps"></core-icon>
        </button>
        <button class="navbar-toggle pull-right" type="button" data-toggle="collapse" data-target="#scr-navbar-context-security">
            <span class="sr-only">Toggle user navigation</span>
            <core-icon icon="perm-identity"></core-icon>
        </button>
        <div class="navbar-brand">
            <a href="/">
                <img src="/bundles/scribeshared/images/src-logo-with-text_@4x.png" alt="Scribe Inc. logo">
            </a>
        </div>
    </div>
    <div id="scr-navbar-context-security" class="collapse navbar-collapse navbar-right">
        <ul class="nav navbar-nav scr-navbar-nav-security navbar-right">
        {% for m in security %}
            {% if m.hasSubMenus and app.user %}
                <li class="dropdown dropdown-supports-sections">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="{{ m.generateUrl }}">
                        <core-icon icon="account-circle"></core-icon><div class="visible-xs-inline-block visible-sm-inline-block">Your Account</div>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-no-sections">
                        {% for i, c in m.getSubMenus %}
                            {% if c.isHeader %}
                                {% if i != 0 %}<li class="divider"></li>{% endif %}
                                <li class="dropdown-header">{{ c.getTitle }}</li>
                            {% else %}
                                <li>
                                    <a href="{{ c.generateUrl }}">
                                        {% if c.hasIcon %}<i class="fa fa-fw {{ c.getIcon }}"></i>{% endif %}
                                        {{ c.getTitle|raw }}
                                    </a>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                    <ul class="dropdown-menu dropdown-menu-sections hidden">
                        {% for i, c in m.getSubMenus %}
                            {% if i == 0 %}
                                <li class="dropdown-menu-sections-wrapper">
                                    <ul>
                            {% endif %}
                            {% if c.isHeader %}
                                {% if i != 0 %}
                                    </ul>
                                </li>
                                <li class="dropdown-menu-sections-wrapper">
                                    <ul>
                                {% endif %}
                                <li class="dropdown-header">{{ c.getTitle }}</li>
                            {% else %}
                                <li class="dropdown-link">
                                    <a href="{{ c.generateUrl }}">
                                        {% if c.hasIcon %}<i class="fa fa-fw {{ c.getIcon }}"></i>{% endif %}
                                        {{ c.getTitle|raw }}
                                    </a>
                                </li>
                            {% endif %}
                        {% endfor %}
                            </ul>
                        </li>
                    </ul>
                </li>
            {% else %}
                <li>
                    <a href="{{ m.generateUrl }}" id="scr-login-button">
                        <core-icon icon="perm-identity"></core-icon><div class="visible-xs-inline-block visible-sm-inline-block">Sign In</div>
                    </a>
                </li>
            {% endif %}
        {% endfor %}
        </ul>
    </div>
    <div id="scr-navbar-context-main" class="collapse navbar-collapse">
        <ul class="nav navbar-nav scr-navbar-nav-main">
        {% for m in main %}
            {% if m.hasSubMenus %}
                <li class="dropdown dropdown-supports-sections">
                    <a class="dropdown-toggle {% if m.isActive %}active{% endif %}" data-toggle="dropdown" href="{{ m.generateUrl }}">
                        <paper-ripple fit></paper-ripple>
                        {{ m.getTitle|raw }}
                        <core-icon icon="arrow-drop-down"></core-icon>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-no-sections">
                        {% for i, c in m.getSubMenus %}
                            {% if c.isHeader %}
                                {% if i != 0 %}<li class="divider"></li>{% endif %}
                                <li class="dropdown-header">{{ c.getTitle }}</li>
                            {% else %}
                                <li>
                                    <a href="{{ c.generateUrl }}">
                                        {% if c.hasIcon %}<i class="fa fa-fw {{ c.getIcon }}"></i>{% endif %}
                                        {{ c.getTitle|raw }}
                                    </a>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                    <ul class="dropdown-menu dropdown-menu-sections hidden">
                        {% for i, c in m.getSubMenus %}
                            {% if i == 0 %}
                                <li class="dropdown-menu-sections-wrapper">
                                    <ul>
                            {% endif %}
                            {% if c.isHeader %}
                                {% if i != 0 %}
                                    </ul>
                                </li>
                                <li class="dropdown-menu-sections-wrapper">
                                    <ul>
                                {% endif %}
                                <li class="dropdown-header">{{ c.getTitle }}</li>
                            {% else %}
                                <li class="dropdown-link">
                                    <a href="{{ c.generateUrl }}">
                                        {% if c.hasIcon %}<i class="fa fa-fw {{ c.getIcon }}"></i>{% endif %}
                                        {{ c.getTitle|raw }}
                                    </a>
                                </li>
                            {% endif %}
                        {% endfor %}
                            </ul>
                        </li>
                    </ul>
                </li>
            {% else %}
                <li>
                    <a class="{% if m.isActive %}active{% endif %}" href="{{ m.generateUrl }}">
                        <paper-ripple fit></paper-ripple>
                        {{ m.getTitle|raw }}
                    </a>
                </li>
            {% endif %}
        {% endfor %}
        </ul>
    </div>
</div>